<form class="{{cssClass}} role-sheet" autocomplete="off">

  <section id="name-alias" class="flex-vertical">
    <div id="name-role" class="flex-horizontal">
      <img src="{{img}}" data-edit="img" title="{{name}}" height="100" width="100"/>

      <div class="grow-two flex-center">
        <div id="name" class="item-block">
          <label class="item-class-label" for="character-{{_id}}-name">{{localize "BITD.Name"}}</label>
          <input type="text" id="character-{{_id}}-name" name="name" value="{{name}}">
        </div>

  		  <div class="item-block flex-horizontal">
          <div class="item-class-label">
            <a class="item-add-popup" data-distinct="true" data-item-type="role">{{localize "BITD.Role"}}</a>
          </div>
          {{#each items as |item id|}}
            {{#if (eq item.type "role")}}
              <div class="item flex-horizontal" data-item-id="{{item._id}}">
                <div class="item-body center flex-horizontal">
                  <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                  <div class="attribute-skill-label tooltip" data-roll-attribute="{{item.name}}">
                    <a class="item-name">{{item.name}}</a>
                    <span class="tooltiptext">{{{item.system.description}}}</span>
                  </div>
                </div>
                <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
              </div>
            {{/if}}
          {{/each}}
        </div>
      </div>
    </div>

    <div id="character-traits" class="flex-vertical">
      {{#if system.type}}
        <div class="item-block flexrow">
          <div class="item-class-label flex1">{{localize "BITD.RoleHeritage"}}</div>
          <div class="attributes-container flex3">
            {{#multiboxes system.traits.heritage}}
              <div class="attribute-stats">
                <input type="radio" id="heritage-{{_id}}-0" data-dtype="String" name="system.traits.heritage" value="0">
                {{#times_from_1 5}}
                  <input type="radio" id="heritage-{{../_id}}-{{this}}" data-dtype="String" name="system.traits.heritage" value="{{this}}">
                  <label for="heritage-{{../_id}}-{{this}}"></label><span class="trait-label flex1">{{localize (lookupstring "BITD.RoleHeritage" this)}}</span>
                {{/times_from_1}}
              </div>
            {{/multiboxes}}
          </div>
        </div>
        <div class="item-block flexrow">
          <div class="item-class-label flex1">{{localize "BITD.RoleReputation"}}</div>
          <div class="attributes-container flex3">
            {{#multiboxes system.traits.reputation}}
              <div class="attribute-stats">
                <input type="radio" id="reputation-{{_id}}-0" data-dtype="String" name="system.traits.reputation" value="0">
                {{#times_from_1 5}}
                  <input type="radio" id="reputation-{{../_id}}-{{this}}" data-dtype="String" name="system.traits.reputation" value="{{this}}">
                  <label for="reputation-{{../_id}}-{{this}}"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." ../system.type) "Reputation") this)}}</span>
                {{/times_from_1}}
              </div>
            {{/multiboxes}}
          </div>
        </div>

        <div class="item-block flexrow">
          <div class="item-class-label flex1">{{localize "BITD.RolePersonality"}}</div>
          <div class="attributes-container flex3">
            <div class="attribute-stats">
              <input type="checkbox" id="personality-{{_id}}-1" data-dtype="Boolean" name="system.traits.personality.one" value="one" {{checked system.traits.personality.one}}>
              <label for="personality-{{_id}}-1"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Personality") 1)}}</span>
              <input type="checkbox" id="personality-{{_id}}-2" data-dtype="Boolean" name="system.traits.personality.two" value="two" {{checked system.traits.personality.two}}>
              <label for="personality-{{_id}}-2"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Personality") 2)}}</span>
              <input type="checkbox" id="personality-{{_id}}-3" data-dtype="Boolean" name="system.traits.personality.three" value="three" {{checked system.traits.personality.three}}>
              <label for="personality-{{_id}}-3"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Personality") 3)}}</span>
              <input type="checkbox" id="personality-{{_id}}-4" data-dtype="Boolean" name="system.traits.personality.four" value="four" {{checked system.traits.personality.four}}>
              <label for="personality-{{_id}}-4"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Personality") 4)}}</span>
              <input type="checkbox" id="personality-{{_id}}-5" data-dtype="Boolean" name="system.traits.personality.five" value="five" {{checked system.traits.personality.five}}>
              <label for="personality-{{_id}}-5"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Personality") 5)}}</span>
            </div>
          </div>
        </div>

        <div class="item-block flexrow">
          <div class="item-class-label flex1">{{localize "BITD.RoleLook"}}</div>
          <div class="attributes-container flex3">
            <div class="attribute-stats">
              <input type="checkbox" id="look-{{_id}}-1" data-dtype="Boolean" name="system.traits.look.one" value="one" {{checked system.traits.look.one}}>
              <label for="look-{{_id}}-1"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Look") 1)}}</span>
              <input type="checkbox" id="look-{{_id}}-2" data-dtype="Boolean" name="system.traits.look.two" value="two" {{checked system.traits.look.two}}>
              <label for="look-{{_id}}-2"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Look") 2)}}</span>
              <input type="checkbox" id="look-{{_id}}-3" data-dtype="Boolean" name="system.traits.look.three" value="three" {{checked system.traits.look.three}}>
              <label for="look-{{_id}}-3"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Look") 3)}}</span>
              <input type="checkbox" id="look-{{_id}}-4" data-dtype="Boolean" name="system.traits.look.four" value="four" {{checked system.traits.look.four}}>
              <label for="look-{{_id}}-4"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Look") 4)}}</span>
              <input type="checkbox" id="look-{{_id}}-5" data-dtype="Boolean" name="system.traits.look.five" value="five" {{checked system.traits.look.five}}>
              <label for="look-{{_id}}-5"></label><span class="trait-label flex1">{{localize (lookupstring (concat (lookupstring "BITD." system.type) "Look") 5)}}</span>
            </div>
          </div>
        </div>
      {{/if}}
    </div>
  </section>
  <br />
  <section id="resources-section" class="flex-horizontal">
    <div class="tab-content flex-vertical grow-two">
      {{!-- Nav menu --}}
      <nav class="tabs flex-horizontal">
        <a class="item" data-tab="duties">{{localize "BITD.Duties"}}</a>
        {{#unless (or (eq system.type "Lorekeeper") (eq system.type "Spymaster"))}}
          <a class="item" data-tab="resources">{{localize "BITD.Resources"}}</a>
        {{/unless}}
        {{#if (eq system.type "Lorekeeper")}}
          <a class="item" data-tab="annals">{{localize "BITD.AnnalsShort"}}</a>
          <a class="item" data-tab="camp">{{localize "BITD.CampShort"}}</a>
        {{/if}}
        {{#if (eq system.type "Spymaster")}}
          <a class="item" data-tab="missions">{{localize "BITD.Missions"}}</a>
        {{/if}}
        {{#if (eq system.type "Marshal")}}
          <a class="item" data-tab="squads">{{localize "BITD.Squads"}}</a>
          <a class="item" data-tab="specialists">{{localize "BITD.Specialists"}}</a>
        {{/if}}
        {{#if (eq system.type "Quartermaster")}}
          <a class="item" data-tab="projects">{{localize "BITD.ProjectsShort"}}</a>
          <a class="item" data-tab="actions">{{localize "BITD.Actions"}}</a>
        {{/if}}
        <a class="item" data-tab="character-notes">{{localize "BITD.Notes"}}</a>
        {{#if isGM}}
          <a class="item" data-tab="effects">{{localize "BITD.Effects"}}</a>
          <a class="item" data-tab="all-character-items">{{localize "BITD.AllItems"}}</a>
        {{/if}}
      </nav>

      <div id="duties" class="tab flex-vertical" data-tab="duties">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Duties"}}</label>{{localize "BITD.DutiesLabel"}}</p>
        </div>
        <div id="duties-list" class="list">
          {{{localize (concat (lookupstring "BITD." system.type) "Duties")}}}
        </div>
      </div>

      <div id="resources" class="tab flex-vertical" data-tab="resources">
        {{#if (eq system.type "Commander")}}
          <div class="label-stripe">
            <p><label class="roll-die-attribute rollable-text" data-roll-attribute="pressure">{{localize "BITD.Pressure"}}</label>{{localize "BITD.PressureLabel"}}</p>
          </div>
          <div id="pressure-list" class="list">
            <div class="flex-horizontal number-input">
              <button {{#if (eq system.resources.pressure 0)}}disabled {{/if}}onclick="this.parentNode.querySelector('input[type=number]').stepDown()" ></button>
              <input id="pressure-{{_id}}" type="number" name="system.resources.pressure" value="{{system.resources.pressure}}">
              <button onclick="this.parentNode.querySelector('input[type=number]').stepUp()" class="plus"></button>
              <label for="pressure-{{_id}}">{{{localize "BITD.PressureDetail"}}}</label>
            </div>
          </div>

          <div class="label-stripe">
            <p><label>{{localize "BITD.Time"}}</label>{{localize "BITD.TimeLabel"}}</p>
          </div>
          <div id="time-list" class="list">
            <div id="time-clocks" class="flex-vertical">
              <div>{{localize "BITD.TimeDetail"}}</div>
              <div class="gradient-stripe-time flex-horizontal">
                <div class="flex-horizontal normal">{{{bob-clock "system.resources.time.timeClock1.value" system.resources.time.timeClock1.type system.resources.time.timeClock1.value (concat _id "-clock-one") "grey"}}}</div>
                <div class="flex-vertical"><p class="caps" style="color:yellow;">{{localize "BITD.Time1"}}</p><p style="color:yellow;">{{localize "BITD.Time2"}}</p></div>
                <div class="flex-horizontal normal">{{{bob-clock "system.resources.time.timeClock2.value" system.resources.time.timeClock2.type system.resources.time.timeClock2.value (concat _id "-clock-two") "yellow"}}}</div>
                <div class="flex-vertical"><p class="caps" style="color:red;">{{localize "BITD.Time3"}}</p><p style="color:red;">{{localize "BITD.Time4"}}</p></div>
                <div class="flex-horizontal normal">{{{bob-clock "system.resources.time.timeClock3.value" system.resources.time.timeClock3.type system.resources.time.timeClock3.value (concat _id "-clock-three") "red"}}}</div>
              </div>
            </div>
          </div>

          <div class="label-stripe">
            <p><label>{{localize "BITD.Intel"}}</label>{{localize "BITD.IntelLabel"}}</p>
          </div>
          <div id="intel-list" class="list">
            <div class="flex-horizontal number-input">
              <button {{#if (eq system.resources.intel 0)}}disabled {{/if}}onclick="this.parentNode.querySelector('input[type=number]').stepDown()" ></button>
              <input id="intel-{{_id}}" type="number" name="system.resources.intel" value="{{system.resources.intel}}">
              <button onclick="this.parentNode.querySelector('input[type=number]').stepUp()" class="plus"></button>
              <label for="intel-{{_id}}">{{{localize "BITD.IntelDetail"}}}</label>
            </div>
            <br />
            <div class="flex-vertical">
              <div class="flex-horizontal">
                <span>{{{localize "BITD.IntelQuestions0"}}}</span>
                {{#if (gt system.resources.intel 0)}}
                  <span>{{{localize "BITD.IntelQuestions1"}}}</span>
                {{/if}}
              </div>
              <div class="flex-horizontal">
                {{#if (gt system.resources.intel 1)}}
                  <span>{{{localize "BITD.IntelQuestions2"}}}</span>
                {{/if}}
                {{#if (gt system.resources.intel 2)}}
                  <span>{{{localize "BITD.IntelQuestions3"}}}</span>
                {{/if}}
              </div>
            </div>
          </div>

        {{else if (eq system.type "Marshal")}}
          <div id="morale" class="label-stripe">
            <p><label>{{localize "BITD.Morale"}}</label>{{localize "BITD.MoraleLabel"}}</p>
          </div>
          <div id="morale-list" class="list">
            <div id="morale-boxes" class="flex-vertical">
              <div class="gradient-stripe-morale flex-horizontal">
                {{#multiboxes system.resources.morale}}
                  <div class="attributes-container">
                    {{#times_from_0 10}}
                      <input type="radio" id="morale-{{../_id}}-{{this}}" data-dtype="String" name="system.resources.morale" value="{{this}}">
                      <label for="morale-{{../_id}}-{{this}}"></label>
                    {{/times_from_0}}
                  </div>
                {{/multiboxes}}
              </div>
              <div>{{{localize "BITD.MoraleDetail"}}}</div>
            </div>
          </div>

          <div class="label-stripe">
            <p><label class="roll-die-attribute rollable-text" data-roll-attribute="engagement">{{localize "BITD.Engagement"}}</label>{{localize "BITD.EngagementLabel"}}</p>
          </div>
          <div id="engagement-list" class="list">
            <div class="flex-horizontal number-input">
              <button {{#if (eq system.resources.engagement 0)}}disabled {{/if}}onclick="this.parentNode.querySelector('input[type=number]').stepDown()" ></button>
              <input id="engagement-{{_id}}" type="number" name="system.resources.engagement" value="{{system.resources.engagement}}">
              <button onclick="this.parentNode.querySelector('input[type=number]').stepUp()" class="plus"></button>
              <label for="engagement-{{_id}}">{{{localize "BITD.EngagementDetail"}}}</label>
            </div>
            <div class="">
              {{{localize "BITD.EngagementGeneral"}}}
            </div>
            <div class="">
              {{{localize "BITD.EngagementAssault"}}}
            </div>
            <div class="">
              {{{localize "BITD.EngagementRecon"}}}
            </div>
            <div class="">
              {{{localize "BITD.EngagementReligious"}}}
            </div>
            <div class="">
              {{{localize "BITD.EngagementSupply"}}}
            </div>
          </div>

        {{else if (eq system.type "Quartermaster")}}
          <div class="label-stripe">
            <p><label>{{localize "BITD.Resources"}}</label></p>
          </div>
          <div>{{{localize "BITD.Actions1Detail"}}}</div>
          <div class="label-stripe">
            <p><label>{{localize "BITD.Supply"}}</label>{{localize "BITD.SupplyLabel"}}</p>
          </div>
          <div id="supply-list" class="list">
            <div class="flex-horizontal number-input">
              <button {{#if (eq system.resources.supply.value 0)}}disabled {{/if}}onclick="this.parentNode.querySelector('input[type=number]').stepDown()" ></button>
              <input id="supply-{{_id}}" type="number" name="system.resources.supply.value" value="{{system.resources.supply.value}}">
              <button {{#if (gteq system.resources.supply.value system.resources.supply.max)}}disabled {{/if}}onclick="this.parentNode.querySelector('input[type=number]').stepUp()" class="plus"></button>
              <label for="supply-{{_id}}">{{{localize "BITD.SupplyDetail"}}}{{system.resources.supply.max}}{{{localize "BITD.SupplyDetail2"}}}</label>
            </div>
          </div>

          <div class="label-stripe">
            <p>
              <label>{{localize "BITD.Materiel"}}</label>
              <a class="item-add-popup" data-item-type="materiel" data-distinct="true"><i class="fas fa-plus-square"></i></a>
              {{localize "BITD.MaterielLabel"}}
            </p>
          </div>
          <div id="materiel-list">
            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.FoodStores"}}  &mdash;  {{localize "BITD.FoodStoresLabel"}}</label>
                <a class="materiel-add" data-mtype="Food Stores"><i class="fas fa-plus-square"></i></a>
              </p>
            </div>
            <div>{{localize "BITD.MaterielDetail"}}</div>
            <div class="container flex-flow">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "materiel") (eq item.system.itemType "Food Stores"))}}
                  <span class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext">{{{item.system.description}}}</span>
                        </span>
                        {{#if (gt item.system.uses 0)}}
                          {{#if @root/dropdowns}}
                            <span class="uses-select">
                              <span>{{localize "BITD.Uses"}}</span>
                              {{#if (lookup2 ../flags.band-of-blades.items item._id 'usagesArray')}}  {{!-- Needed because array is created in onCreate() after first pass of sheet re-render and array can't be created in preCreate() --}}
                                <select id="itemuses-{{item._id}}" name="flags.band-of-blades.items.{{item._id}}.usages" data-dtype="String">{{selectOptions (lookup2 ../flags.band-of-blades.items item._id 'usagesArray') selected=(lookup2 ../flags.band-of-blades.items item._id 'usages') localize=true}}</select>
                              {{/if}}
                            </span>
                          {{else}}
                            <div class="usage-stats">
                              {{#multiboxes (lookup2 ../flags.band-of-blades.items item._id 'usages')}}
                                {{#times_from_0 @root/foodStores}}
                                  <input type="radio" id="usages-{{item._id}}-{{this}}" data-dtype="String" name="flags.band-of-blades.items.{{item._id}}.usages" value="{{this}}">
                                  <label for="usages-{{item._id}}-{{this}}"></label>
                                {{/times_from_0}}
                              {{/multiboxes}}
                            </div>
                          {{/if}}
                        {{/if}}
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </span>
                {{/if}}
              {{/each}}
            </div>

            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.BlackShot"}}  &mdash;  {{localize "BITD.BlackShotLabel"}}</label>
                <a class="materiel-add" data-mtype="Black Shot"><i class="fas fa-plus-square"></i></a>
              </p>
            </div>
            <div class="container flex-flow">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "materiel") (eq item.system.itemType "Black Shot"))}}
                  <span class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext">{{{item.system.description}}}</span>
                        </span>
                        {{#if (gt item.system.uses 0)}}
                          {{#if @root/dropdowns}}
                            <span class="uses-select">
                              <span>{{localize "BITD.Uses"}}</span>
                              {{#if (lookup2 ../flags.band-of-blades.items item._id 'usagesArray')}}  {{!-- Needed because array is created in onCreate() after first pass of sheet re-render and array can't be created in preCreate() --}}
                                <select id="itemuses-{{item._id}}" name="flags.band-of-blades.items.{{item._id}}.usages" data-dtype="String">{{selectOptions (lookup2 ../flags.band-of-blades.items item._id 'usagesArray') selected=(lookup2 ../flags.band-of-blades.items item._id 'usages') localize=true}}</select>
                              {{/if}}
                            </span>
                          {{else}}
                            <div class="usage-stats">
                              {{#multiboxes (lookup2 ../flags.band-of-blades.items item._id 'usages')}}
                                {{#times_from_0 item.system.uses}}
                                  <input type="radio" id="usages-{{item._id}}-{{this}}" data-dtype="String" name="flags.band-of-blades.items.{{item._id}}.usages" value="{{this}}">
                                  <label for="usages-{{item._id}}-{{this}}"></label>
                                {{/times_from_0}}
                              {{/multiboxes}}
                            </div>
                          {{/if}}
                        {{/if}}
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </span>
                {{/if}}
              {{/each}}
            </div>

            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.Horses"}}  &mdash;  {{localize "BITD.HorsesLabel"}}</label>
                <a class="materiel-add" data-mtype="Horses"><i class="fas fa-plus-square"></i></a>
              </p>
            </div>
            <div class="container flex-flow">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "materiel") (eq item.system.itemType "Horses"))}}
                  <span class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext">{{{item.system.description}}}</span>
                        </span>
                        {{#if (gt item.system.uses 0)}}
                          {{#if @root/dropdowns}}
                            <span class="uses-select">
                              <span>{{localize "BITD.Uses"}}</span>
                              {{#if (lookup2 ../flags.band-of-blades.items item._id 'usagesArray')}}  {{!-- Needed because array is created in onCreate() after first pass of sheet re-render and array can't be created in preCreate() --}}
                                <select id="itemuses-{{item._id}}" name="flags.band-of-blades.items.{{item._id}}.usages" data-dtype="String">{{selectOptions (lookup2 ../flags.band-of-blades.items item._id 'usagesArray') selected=(lookup2 ../flags.band-of-blades.items item._id 'usages') localize=true}}</select>
                              {{/if}}
                            </span>
                          {{else}}
                            <div class="usage-stats">
                              {{#multiboxes (lookup2 ../flags.band-of-blades.items item._id 'usages')}}
                                {{#times_from_0 item.system.uses}}
                                  <input type="radio" id="usages-{{item._id}}-{{this}}" data-dtype="String" name="flags.band-of-blades.items.{{item._id}}.usages" value="{{this}}">
                                  <label for="usages-{{item._id}}-{{this}}"></label>
                                {{/times_from_0}}
                              {{/multiboxes}}
                            </div>
                          {{/if}}
                        {{/if}}
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </span>
                {{/if}}
              {{/each}}
            </div>

            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.ReligiousSupplies"}}  &mdash;  {{localize "BITD.ReligiousSuppliesLabel"}}</label>
                <a class="materiel-add" data-mtype="Religious Supplies"><i class="fas fa-plus-square"></i></a>
              </p>
            </div>
            <div class="container flex-flow">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "materiel") (eq item.system.itemType "Religious Supplies"))}}
                  <span class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext">{{{item.system.description}}}</span>
                        </span>
                        {{#if (gt item.system.uses 0)}}
                          {{#if @root/dropdowns}}
                            <span class="uses-select">
                              <span>{{localize "BITD.Uses"}}</span>
                              {{#if (lookup2 ../flags.band-of-blades.items item._id 'usagesArray')}}  {{!-- Needed because array is created in onCreate() after first pass of sheet re-render and array can't be created in preCreate() --}}
                                <select id="itemuses-{{item._id}}" name="flags.band-of-blades.items.{{item._id}}.usages" data-dtype="String">{{selectOptions (lookup2 ../flags.band-of-blades.items item._id 'usagesArray') selected=(lookup2 ../flags.band-of-blades.items item._id 'usages') localize=true}}</select>
                              {{/if}}
                            </span>
                          {{else}}
                            <div class="usage-stats">
                              {{#multiboxes (lookup2 ../flags.band-of-blades.items item._id 'usages')}}
                                {{#times_from_0 item.system.uses}}
                                  <input type="radio" id="usages-{{item._id}}-{{this}}" data-dtype="String" name="flags.band-of-blades.items.{{item._id}}.usages" value="{{this}}">
                                  <label for="usages-{{item._id}}-{{this}}"></label>
                                {{/times_from_0}}
                              {{/multiboxes}}
                            </div>
                          {{/if}}
                        {{/if}}
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </span>
                {{/if}}
              {{/each}}
            </div>

            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.SiegeWeapons"}}  &mdash;  {{localize "BITD.SiegeWeaponsLabel"}}</label>
                <a class="materiel-add" data-mtype="Siege Weapons"><i class="fas fa-plus-square"></i></a>
              </p>
            </div>
            <div class="container flex">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "materiel") (eq item.system.itemType "Siege Weapons"))}}
                  <span class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext">{{{item.system.description}}}</span>
                        </span>
                        {{#if (gt item.system.uses 0)}}
                          {{#if @root/dropdowns}}
                            <span class="uses-select">
                              <span>{{localize "BITD.Uses"}}</span>
                              {{#if (lookup2 ../flags.band-of-blades.items item._id 'usagesArray')}}  {{!-- Needed because array is created in onCreate() after first pass of sheet re-render and array can't be created in preCreate() --}}
                                <select id="itemuses-{{item._id}}" name="flags.band-of-blades.items.{{item._id}}.usages" data-dtype="String">{{selectOptions (lookup2 ../flags.band-of-blades.items item._id 'usagesArray') selected=(lookup2 ../flags.band-of-blades.items item._id 'usages') localize=true}}</select>
                              {{/if}}
                            </span>
                          {{else}}
                            <div class="usage-stats">
                              {{#multiboxes (lookup2 ../flags.band-of-blades.items item._id 'usages')}}
                                {{#times_from_0 item.system.uses}}
                                  <input type="radio" id="usages-{{item._id}}-{{this}}" data-dtype="String" name="flags.band-of-blades.items.{{item._id}}.usages" value="{{this}}">
                                  <label for="usages-{{item._id}}-{{this}}"></label>
                                {{/times_from_0}}
                              {{/multiboxes}}
                            </div>
                          {{/if}}
                        {{/if}}
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </span>
                {{/if}}
              {{/each}}
            </div>

            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.SupplyCart"}}  &mdash;  {{localize "BITD.SupplyCartLabel"}}</label>
                <a class="materiel-add" data-mtype="Supply Cart"><i class="fas fa-plus-square"></i></a>
              </p>
            </div>
            <div class="container flex">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "materiel") (eq item.system.itemType "Supply Cart"))}}
                  <span class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext">{{{item.system.description}}}</span>
                        </span>
                        {{#if (gt item.system.uses 0)}}
                          {{#if @root/dropdowns}}
                            <span class="uses-select">
                              <span>{{localize "BITD.Uses"}}</span>
                              {{#if (lookup2 ../flags.band-of-blades.items item._id 'usagesArray')}}  {{!-- Needed because array is created in onCreate() after first pass of sheet re-render and array can't be created in preCreate() --}}
                                <select id="itemuses-{{item._id}}" name="flags.band-of-blades.items.{{item._id}}.usages" data-dtype="String">{{selectOptions (lookup2 ../flags.band-of-blades.items item._id 'usagesArray') selected=(lookup2 ../flags.band-of-blades.items item._id 'usages') localize=true}}</select>
                              {{/if}}
                            </span>
                          {{else}}
                            <div class="usage-stats">
                              {{#multiboxes (lookup2 ../flags.band-of-blades.items item._id 'usages')}}
                                {{#times_from_0 item.system.uses}}
                                  <input type="radio" id="usages-{{item._id}}-{{this}}" data-dtype="String" name="flags.band-of-blades.items.{{item._id}}.usages" value="{{this}}">
                                  <label for="usages-{{item._id}}-{{this}}"></label>
                                {{/times_from_0}}
                              {{/multiboxes}}
                            </div>
                          {{/if}}
                        {{/if}}
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </span>
                {{/if}}
              {{/each}}
            </div>
          </div>

          <div class="label-stripe">
            <p>
              <label>{{localize "BITD.Personnel"}}</label>
              <a class="item-add-popup" data-item-type="personnel" data-distinct="true"><i class="fas fa-plus-square"></i></a>
              {{localize "BITD.PersonnelLabel"}}
            </p>
          </div>
          <div id="personnel-list">
            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.Mercies"}}  &mdash;  {{localize "BITD.MerciesLabel"}}</label>
                {{#if (lt system.resources.mercies 3)}}
                  <a class="personnel-add" data-mtype="Mercy"><i class="fas fa-plus-square"></i></a>
                {{/if}}
              </p>
            </div>
            <div class="container flex-flow">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "personnel") (eq item.system.itemType "Mercy") )}}
                  <div class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext">{{{item.system.description}}}</span>
                        </span>
                        <span class="wound-checkboxes center flex-horizontal">
                          <input id="wounded-{{item._id}}" type="checkbox" name="flags.band-of-blades.items.{{item._id}}.wounded" {{checked (lookup2 ../flags.band-of-blades.items item._id 'wounded')}}>
                          <label for="wounded-{{item._id}}"></label>
                          <span>{{localize "BITD.Wounded"}}</span>
                        </span>
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </div>
                {{/if}}
              {{/each}}
            </div>
            <div class="label-stripe-gray">
              <p>
                <label><span class="roll-die-attribute rollable-text" data-roll-attribute="alchemists">{{localize "BITD.Alchemists"}}</span>  &mdash;  {{localize "BITD.AlchemistsLabel"}}</label>
                {{#if (lt system.resources.alchemists 3)}}
                  <a class="personnel-add" data-mtype="Alchemist"><i class="fas fa-plus-square"></i></a>
                {{/if}}
              </p>
            </div>
            <div class="container flex-flow">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "personnel") (eq item.system.itemType "Alchemist") )}}
                  <div class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext top">{{{item.system.description}}}</span>
                        </span>
                        {{#if (gt item.system.uses 0)}}
                          <span class="uses-select">
                            <div class="flex-horizontal small">{{{bob-clock (concat "flags.band-of-blades.items." item._id ".usages") (num (lookup2 ../flags.band-of-blades.items item._id 'usagesMax')) (str (lookup2 ../flags.band-of-blades.items item._id 'usages')) (concat item._id "-clock") "green"}}}</div>
                            <span>{{localize "BITD.Corruption"}}</span>
                          </span>
                        {{/if}}
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </div>
                {{/if}}
              {{/each}}
            </div>

            <div class="label-stripe-gray">
              <p>
                <label>{{localize "BITD.Laborers"}}  &mdash;  {{localize "BITD.LaborersLabel"}}</label>
                {{#if (lt system.resources.laborers 3)}}
                  <a class="personnel-add" data-mtype="Laborer"><i class="fas fa-plus-square"></i></a>
                {{/if}}
              </p>
            </div>
            <div class="container flex-flow">
              {{#each items as |item id|}}
                {{#if (and (eq item.type "personnel") (eq item.system.itemType "Laborer") )}}
                  <div class="item flex-horizontal" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip"><a class="item-name">{{item.name}}</a>
                          <span class="tooltiptext top">{{{item.system.description}}}</span>
                        </span>
                      </span>
                    </span>
                    <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                    <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                  </div>
                {{/if}}
              {{/each}}
            </div>
          </div>
        {{/if}}
      </div>

      <div id="projects" class="tab flex-vertical" data-tab="projects">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Projects"}}</label>{{localize "BITD.ProjectsLabel"}}</p>
        </div>
        <div id="project-list" class="list">
          <div id="project-clocks" class="flex-vertical">
            <div>{{{localize "BITD.Actions3Detail"}}}</div>
            <div class="flex-vertical">
              <div class="label-stripe-gray project" data-project="clock1">
                <p style="margin-top: 11px;"><a class="item-control project-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a></p>
                <p><input type="text" name="system.resources.projects.clock1.name" value="{{system.resources.projects.clock1.name}}"></p>
              </div>
              <div class="flexrow">
                <div class="flex3"><textarea name="system.resources.projects.clock1.description">{{system.resources.projects.clock1.description}}</textarea></div>
                <div class="project-clock">
                  <div class="flex1">
                    {{{bob-clock "system.resources.projects.clock1.value" system.resources.projects.clock1.type system.resources.projects.clock1.value (concat _id "-clock1-project") system.resources.projects.clock1.color }}}
                  </div>
                  <div class="clock-options">
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock1.type">
                        {{{system.size_list.clock1}}}
                      </select>
                    </div>
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock1.color">
                        {{{system.color_list.clock1}}}
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="label-stripe-gray project" data-project="clock2">
                <p style="margin-top: 11px;"><a class="item-control project-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a></p>
                <p><input type="text" name="system.resources.projects.clock2.name" value="{{system.resources.projects.clock2.name}}"></p>
              </div>
              <div class="flexrow">
                <div class="flex3"><textarea name="system.resources.projects.clock2.description">{{system.resources.projects.clock2.description}}</textarea></div>
                <div class="project-clock">
                  <div class="flex1">
                    {{{bob-clock "system.resources.projects.clock2.value" system.resources.projects.clock2.type system.resources.projects.clock2.value (concat _id "-clock2-project") system.resources.projects.clock2.color }}}
                  </div>
                  <div class="clock-options">
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock2.type">
                        {{{system.size_list.clock2}}}
                      </select>
                    </div>
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock2.color">
                        {{{system.color_list.clock2}}}
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="label-stripe-gray project" data-project="clock3">
                <p style="margin-top: 11px;"><a class="item-control project-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a></p>
                <p><input type="text" name="system.resources.projects.clock3.name" value="{{system.resources.projects.clock3.name}}"></p>
              </div>
              <div class="flexrow">
                <div class="flex3"><textarea name="system.resources.projects.clock3.description">{{system.resources.projects.clock3.description}}</textarea></div>
                <div class="project-clock">
                  <div class="flex1">
                    {{{bob-clock "system.resources.projects.clock3.value" system.resources.projects.clock3.type system.resources.projects.clock3.value (concat _id "-clock3-project") system.resources.projects.clock3.color }}}
                  </div>
                  <div class="clock-options">
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock3.type">
                        {{{system.size_list.clock3}}}
                      </select>
                    </div>
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock3.color">
                        {{{system.color_list.clock3}}}
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="label-stripe-gray project" data-project="clock4">
                <p style="margin-top: 11px;"><a class="item-control project-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a></p>
                <p><input type="text" name="system.resources.projects.clock4.name" value="{{system.resources.projects.clock4.name}}"></p>
              </div>
              <div class="flexrow">
                <div class="flex3"><textarea name="system.resources.projects.clock4.description">{{system.resources.projects.clock4.description}}</textarea></div>
                <div class="project-clock">
                  <div class="flex1">
                    {{{bob-clock "system.resources.projects.clock4.value" system.resources.projects.clock4.type system.resources.projects.clock4.value (concat _id "-clock4-project") system.resources.projects.clock4.color }}}
                  </div>
                  <div class="clock-options">
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock4.type">
                        {{{system.size_list.clock4}}}
                      </select>
                    </div>
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock4.color">
                        {{{system.color_list.clock4}}}
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="label-stripe-gray project" data-project="clock5">
                <p style="margin-top: 11px;"><a class="item-control project-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a></p>
                <p><input type="text" name="system.resources.projects.clock5.name" value="{{system.resources.projects.clock5.name}}"></p>
              </div>
              <div class="flexrow">
                <div class="flex3"><textarea name="system.resources.projects.clock5.description">{{system.resources.projects.clock5.description}}</textarea></div>
                <div class="project-clock">
                  <div class="flex1">
                    {{{bob-clock "system.resources.projects.clock5.value" system.resources.projects.clock5.type system.resources.projects.clock5.value (concat _id "-clock5-project") system.resources.projects.clock5.color }}}
                  </div>
                  <div class="clock-options">
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock5.type">
                        {{{system.size_list.clock5}}}
                      </select>
                    </div>
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock5.color">
                        {{{system.color_list.clock5}}}
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="label-stripe-gray project" data-project="clock6">
                <p style="margin-top: 11px;"><a class="item-control project-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a></p>
                <p><input type="text" name="system.resources.projects.clock6.name" value="{{system.resources.projects.clock6.name}}"></p>
              </div>
              <div class="flexrow">
                <div class="flex3"><textarea name="system.resources.projects.clock6.description">{{system.resources.projects.clock6.description}}</textarea></div>
                <div class="project-clock">
                  <div class="flex1">
                    {{{bob-clock "system.resources.projects.clock6.value" system.resources.projects.clock6.type system.resources.projects.clock6.value (concat _id "-clock6-project") system.resources.projects.clock6.color }}}
                  </div>
                  <div class="clock-options">
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock6.type">
                        {{{system.size_list.clock6}}}
                      </select>
                    </div>
                    <div class="hp-clock">
                      <select name="system.resources.projects.clock6.color">
                        {{{system.color_list.clock6}}}
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="annals" class="tab flex-vertical" data-tab="annals">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Annals"}}</label>{{localize "BITD.AnnalsLabel"}}</p>
        </div>
        <div>{{localize "BITD.AnnalsDetail"}}</div>
        {{#times_from_0 fallenBlocks}}
          <div class="flexrow">
            <div class="flex1">
              {{#each ../system.resources.fallen as |fallen findex|}}
                {{#if (or (and (gteq findex (mult ../this 4) ) (lt findex (mult (add ../this 1) 4 ) ) ) (and @last (notNum ../this) (lt findex 4)))}}
                  <input type="text" id="fallen-{{../../_id}}-name-{{findex}}" name="system.resources.fallen.{{findex}}" value="{{fallen}}" placeholder="Name">
                  <label style="display:none;" class="fallen-label" for="fallen-{{../../_id}}-name-{{findex}}"></label>
                {{/if}}
              {{/each}}
            </div>
            {{#if (lt this 5)}}
              <div class="flex2">
                <div class="label-stripe-gray">
                  <p>{{localize (concat "BITD.AnnalsLabel" this)}}</p>
                </div>
                <div>{{{localize (concat "BITD.AnnalsDetail" this)}}}</div>
              </div>
              <div class="flex2">
                <div class="label-stripe-gray">
                  <p>{{localize "BITD.AnnalsEffectLabel"}}</p>
                </div>
                <div>{{{localize (concat "BITD.AnnalsEffect" this)}}}</div>
              </div>
            {{else}}
              <div class="flex2">
                <div class="label-stripe-gray">
                  <p>{{localize "BITD.AnnalsLabel5"}}</p>
                </div>
                <div>{{{localize "BITD.AnnalsDetail5"}}}</div>
              </div>
            {{/if}}
          </div>
        {{/times_from_0}}
      </div>

      <div id="camp" class="tab flex-vertical" data-tab="camp">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Camp"}}</label>{{localize "BITD.CampLabel"}}</p>
        </div>
        <div>{{localize "BITD.CampDetail"}}</div>
        <table class="camp-scenes">
          <tr>
            <th colspan="2">
              <div class="label-stripe-gray">
                <p>{{localize "BITD.HighMorale"}}</p>
              </div>
            </th>
          </tr>
          {{#times_from_x 1 6}}
          <tr class="high-morale">
            <td>
              <input type="checkbox" data-dType="Boolean" id="camp-{{../_id}}-{{this}}" name="system.resources.camp.{{this}}" {{checked (lookup ../system.resources.camp this)}}>
            </td>
            <td>
              <label for="camp-{{../_id}}-{{this}}">{{localize (concat "BITD.CampMorale" this)}}</label>
            </td>
          </tr>
          {{/times_from_x}}
          <tr>
            <th colspan="2">
              <div class="label-stripe-gray">
                <p>{{localize "BITD.MediumMorale"}}</p>
              </div>
            </th>
          </tr>
          {{#times_from_x 7 11}}
            <tr class="medium-morale">
              <td>
                <input type="checkbox" data-dType="Boolean" id="camp-{{../_id}}-{{this}}" name="system.resources.camp.{{this}}" {{checked (lookup ../system.resources.camp this)}}>
              </td>
              <td>
                <label for="camp-{{../_id}}-{{this}}">{{localize (concat "BITD.CampMorale" this)}}</label>
              </td>
            </tr>
          {{/times_from_x}}
          <tr class="medium-morale">
            <td>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-12-one" name="system.resources.camp.12.one" {{checked system.resources.camp.12.one }}>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-12-two" name="system.resources.camp.12.two" {{checked system.resources.camp.12.two }}>
            </td>
            <td>
              <label for="camp-{{_id}}-12-one">{{localize "BITD.CampMorale12"}}</label>
              <label for="camp-{{_id}}-12-two" style="display:none;"></label>
            </td>
          </tr>
          <tr>
            <th colspan="2">
              <div class="label-stripe-gray">
                <p>{{localize "BITD.LowMorale"}}</p>
              </div>
            </th>
          </tr>
          {{#times_from_x 13 15}}
            <tr class="low-morale">
              <td>
                <input type="checkbox" data-dType="Boolean" id="camp-{{../_id}}-{{this}}" name="system.resources.camp.{{this}}" {{checked (lookup ../system.resources.camp this)}}>
              </td>
              <td>
                <label for="camp-{{../_id}}-{{this}}">{{localize (concat "BITD.CampMorale" this)}}</label>
              </td>
            </tr>
          {{/times_from_x}}
          <tr class="low-morale">
            <td>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-16-one" name="system.resources.camp.16.one" {{checked system.resources.camp.16.one }}>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-16-two" name="system.resources.camp.16.two" {{checked system.resources.camp.16.two }}>
            </td>
            <td>
              <label for="camp-{{_id}}-16-one">{{localize "BITD.CampMorale16"}}</label>
              <label for="camp-{{_id}}-16-two" style="display:none;"></label>
            </td>
          </tr>
          <tr class="low-morale">
            <td>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-17-one" name="system.resources.camp.17.one" {{checked system.resources.camp.17.one }}>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-17-two" name="system.resources.camp.17.two" {{checked system.resources.camp.17.two }}>
            </td>
            <td>
              <label for="camp-{{_id}}-17-one">{{localize "BITD.CampMorale17"}}</label>
              <label for="camp-{{_id}}-17-two" style="display:none;"></label>
            </td>
          </tr>
          <tr class="low-morale">
            <td>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-18-one" name="system.resources.camp.18.one" {{checked system.resources.camp.18.one }}>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-18-two" name="system.resources.camp.18.two" {{checked system.resources.camp.18.two }}>
              <input type="checkbox" data-dType="Boolean" id="camp-{{_id}}-18-three" name="system.resources.camp.18.three" {{checked system.resources.camp.18.three }}>
            </td>
            <td>
              <label for="camp-{{../_id}}-18-one">{{localize "BITD.CampMorale18"}}</label>
              <label for="camp-{{../_id}}-18-two" style="display:none;"></label>
              <label for="camp-{{../_id}}-18-three" style="display:none;"></label>
            </td>
          </tr>
        </table>
      </div>

      <div id="missions" class="tab flex-vertical" data-tab="missions">
        <div class="label-stripe">
          <p>
            <label>{{localize "BITD.Spies"}}</label>
            <a class="item-add-popup" data-item-type="spies">
              <i class="fas fa-plus-square"></i>
            </a>
            {{{localize "BITD.SpiesLabel"}}}
            <div class="total-spies" {{#if (gt system.spies system.resources.spies)}}style="color:red;"{{/if}}>
              {{system.spies}} / {{system.resources.spies}}
              <span>{{localize "BITD.MaxSpies"}}</span>
            </div>
          </p>
        </div>
        <div id="spies-list">
          <div class="container flex-vertical">
            {{#each items as |item id|}}
              {{#if (eq item.type "spies")}}
                <div class="flex-vertical summary-anchor">
                  <div class="item flex-vertical" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip expandable" data-expand="{{{item.system.special}}}">
                          <a>{{item.name}}</a>
                        </span>
                        <span class="wound-checkboxes center flex-horizontal">
                          <input id="master-{{item._id}}" type="checkbox" name="flags.band-of-blades.items.{{item._id}}.master" {{checked (lookup2 ../flags.band-of-blades.items item._id 'master')}}>
                          <label for="master-{{item._id}}"></label>
                          {{#if (lookup2 ../flags.band-of-blades.items item._id 'master')}}
                            <span>{{localize "BITD.Master"}}</span>
                          {{else}}
                            <span>{{localize "BITD.Trained"}}</span>
                          {{/if}}
                          <input id="wounded-{{item._id}}" type="checkbox" name="flags.band-of-blades.items.{{item._id}}.wounded" {{checked (lookup2 ../flags.band-of-blades.items item._id 'wounded')}}>
                          <label for="wounded-{{item._id}}"></label>
                          <span>{{localize "BITD.Wounded"}}</span>
                        </span>
                      </span>
                      <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                      <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                    </span>
                  </div>
                </div>
              {{/if}}
            {{/each}}
          </div>
        </div>
        <div class="label-stripe">
          <p><label>{{localize "BITD.Network"}}</label>
            <a class="item-add-popup" data-item-type="network">
              <i class="fas fa-plus-square"></i>
            </a>
          </p>
        </div>
        <div id="network-list">
          <div class="container flex-vertical">
            {{#each items as |item id|}}
              {{#if (eq item.type "network")}}
                <div class="flex-vertical summary-anchor">
                  <div class="item flex-vertical" data-item-id="{{item._id}}">
                    <span class="item-body flex-horizontal">
                      <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                      <span class="center flex-horizontal">
                        <span class="tooltip expandable" data-expand="{{{item.system.description}}}">
                          <a>{{item.name}}</a>
                        </span>
                      </span>
                      <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
                      <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
                    </span>
                  </div>
                </div>
              {{/if}}
            {{/each}}
          </div>
        </div>
        <div class="label-stripe">
          <p><label>{{localize "BITD.SMissions"}}</label>{{localize "BITD.SMissionsLabel"}}</p>
        </div>
        <div>{{{localize "BITD.SMissionsDetail"}}}</div>
        <div class="label-stripe">
          <p><label>{{localize "BITD.LTMissions"}}</label>{{localize "BITD.LTMissionsLabel"}}</p>
        </div>
        <div id="mission-list" class="list">
          <div id="mission-clocks" class="flex-vertical">
            <div>{{{localize "BITD.LTMissionsDetail"}}}</div>
            <div class="flex-vertical">
              <div class="label-stripe-gray">
                <p class="roll-die-attribute rollable-text" data-roll-attribute="mission">{{localize "BITD.AugmentLabel"}}</p>
                <p class="spy-select">
                  <span>{{localize "BITD.AssignedSpy"}}</span>
                  <select id="spyuses-augment-{{_id}}" name="system.resources.missions.augmentSpy">{{selectOptions spyList selected=system.resources.missions.augmentSpy localize=true}}</select>
                </p>
              </div>
              <div class="flexrow">
                <div class="flex3"><p>{{{localize "BITD.AugmentDetail"}}}</p></div>
                <div class="flex1">{{{bob-clock "system.resources.missions.augmentClock.value" system.resources.missions.augmentClock.type system.resources.missions.augmentClock.value (concat _id "-clock-augment") "red"}}}</div>
              </div>
              <div class="label-stripe-gray">
                <p class="roll-die-attribute rollable-text" data-roll-attribute="mission">{{localize "BITD.ExpandLabel"}}</p>
                <p class="spy-select">
                  <span>{{localize "BITD.AssignedSpy"}}</span>
                  <select id="spyuses-expand-{{_id}}" name="system.resources.missions.expandSpy">{{selectOptions spyList selected=system.resources.missions.expandSpy localize=true}}</select>
                </p>
              </div>
              <div class="flexrow">
                <div class="flex3"><p>{{{localize "BITD.ExpandDetail"}}}</p></div>
                <div class="flex1">{{{bob-clock "system.resources.missions.expandClock.value" system.resources.missions.expandClock.type system.resources.missions.expandClock.value (concat _id "-clock-expand") "red"}}}</div>
              </div>
              <div class="label-stripe-gray">
                <p class="roll-die-attribute rollable-text" data-roll-attribute="mission">{{localize "BITD.TrapLabel"}}</p>
                <p class="spy-select">
                  <span>{{localize "BITD.AssignedSpy"}}</span>
                  <select id="spyuses-trap-{{_id}}" name="system.resources.missions.trapSpy">{{selectOptions spyList selected=system.resources.missions.trapSpy localize=true}}</select>
                </p>
              </div>
              <div class="flexrow">
                <div class="flex3"><p>{{{localize "BITD.TrapDetail"}}}</p></div>
                <div class="flex1">{{{bob-clock "system.resources.missions.trapClock.value" system.resources.missions.trapClock.type system.resources.missions.trapClock.value (concat _id "-clock-trap") "red"}}}</div>
              </div>
              <div class="label-stripe-gray">
                <p class="roll-die-attribute rollable-text" data-roll-attribute="mission">{{localize "BITD.RecruitLabel"}}</p>
                <p class="spy-select">
                  <span>{{localize "BITD.AssignedSpy"}}</span>
                  <select id="spyuses-recruit-{{_id}}" name="system.resources.missions.recruitSpy">{{selectOptions spyList selected=system.resources.missions.recruitSpy localize=true}}</select>
                </p>
              </div>
              <div class="flexrow">
                <div class="flex3"><p>{{{localize "BITD.RecruitDetail"}}}</p></div>
                <div class="flex1">{{{bob-clock "system.resources.missions.recruitClock.value" system.resources.missions.recruitClock.type system.resources.missions.recruitClock.value (concat _id "-clock-recruit") "red"}}}</div>
              </div>
              <div class="label-stripe-gray">
                <p class="roll-die-attribute rollable-text" data-roll-attribute="mission">{{localize "BITD.ResearchLabel"}}</p>
                <p class="spy-select">
                  <span>{{localize "BITD.AssignedSpy"}}</span>
                  <select id="spyuses-research-{{_id}}" name="system.resources.missions.researchSpy">{{selectOptions spyList selected=system.resources.missions.researchSpy localize=true}}</select>
                </p>
              </div>
              <div class="flexrow">
                <div class="flex3"><p>{{{localize "BITD.ResearchDetail"}}}</p></div>
                <div class="flex1">{{{bob-clock "system.resources.missions.researchClock.value" system.resources.missions.researchClock.type system.resources.missions.researchClock.value (concat _id "-clock-research") "red"}}}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="squads" class="tab flex-vertical" data-tab="squads">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Squads"}}</label>{{localize "BITD.SquadsLabel"}}</p>
        </div>
        {{#each squads as |squad sindex|}}
          <div class="label-stripe-gray">
            <p class="tooltip">
              {{squad.name}}
              <a class="rookie-create" data-item-type="{{squad.name}}">
                <i class="fas fa-plus-square">
                  <span class="tooltiptext">{{localize "BITD.CreateRookies"}}</span>
                </i>
              </a>
            </p>
          </div>
          <div class="container flex-flow">
            {{#each ../squaddies as |squaddie lindex|}}
              {{#if (eq squaddie.system.squad squad.name)}}
                <span class="item flex-horizontal" data-item-id="{{squaddie._id}}">
                  <span class="item-body flex-left">
                    <img src="{{squaddie.img}}" title="{{squaddie.name}}" width="24" height="24"/>
                    <span class="attribute-skill-label">
                      <a class="actor-name">{{squaddie.name}}</a>
                    </span>
                    <span id="wounds-stress-{{squaddie._id}}" class="wst flex-horizontal">
                      <span class="flex-vertical">
                        <span class="flex-horizontal">
                          <span class="wounds-boxes attributes-container flex-horizontal">
                              <span>{{localize "BITD.Wounds"}}</span>
                              <input id="wounds-light-{{squaddie._id}}" disabled type="radio" data-dtype="String" name="squaddie.system.lightBox" value="{{squaddie.system.lightBox}}">
                              <label for="wounds-light-{{squaddie._id}}" style="background-color: {{squaddie.system.lightBox}};"></label>
                              <input id="wounds-medium-{{squaddie._id}}" disabled type="radio" data-dtype="String" name="squaddie.system.mediumBox" value="{{squaddie.system.mediumBox}}">
                              <label for="wounds-medium-{{squaddie._id}}" style="background-color: {{squaddie.system.mediumBox}};"></label>
                              <input id="wounds-heavy-{{squaddie._id}}" disabled type="radio" data-dtype="String" name="squaddie.system.heavyBox" value="{{squaddie.system.heavyBox}}">
                              <label for="wounds-heavy-{{squaddie._id}}" style="background-color: {{squaddie.system.heavyBox}};"></label>
                          </span>
                          <span class="stress-boxes flex-horizontal">
                            <label for="stress-{{squaddie._id}}">{{localize "BITD.Stress"}}</label>
                            <input id="stress-{{squaddie._id}}" type="text" disabled name="squaddie.system.stress.value" value="{{squaddie.system.stress.value}} / {{str squaddie.system.stress.max}}">
                          </span>
                        </span>
                        <span class="flex-horizontal">
                          <span class="stress-boxes flex-horizontal">
                             <label for="trauma-{{squaddie._id}}">{{localize "BITD.Trauma"}}</label>
                             <input id="trauma-{{squaddie._id}}" type="text" disabled name="squaddie.system.trauma.value" value="{{squaddie.system.trauma.value}} / {{str squaddie.system.trauma.max}}">
                          </span>
                          <span class="stress-boxes flex-horizontal">
                             <label for="blight-{{squaddie._id}}">{{localize "BITD.Blight"}}</label>
                             <input id="blight-{{squaddie._id}}" type="text" disabled name="squaddie.system.blight.value" value="{{squaddie.system.blight.value}} / {{str squaddie.system.blight.max}}">
                          </span>
                        </span>
                      </span>
                    </span>
                  </span>
                </span>
              {{/if}}
            {{/each}}
          </div>
        {{/each}}
      </div>

      <div id="specialists" class="tab flex-vertical" data-tab="specialists">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Specialists"}}</label>{{localize "BITD.SpecialistsLabel"}}</p>
        </div>
        {{#each specialistTypes as |specType sindex|}}
          <div class="label-stripe-gray">{{specType.name}}  &mdash;  {{localize (concat "BITD." (lookup specType 'name') "Label")}}</div>
          <div class="container flex-flow">
            {{#each ../specialists as |specialist lindex|}}
              {{#if (eq specialist.system.class specType.name)}}
                <span class="item flex-horizontal" data-item-id="{{specialist._id}}">
                  <span class="item-body flex-left">
                    <img src="{{specialist.img}}" title="{{specialist.name}}" width="24" height="24"/>
                    <span class="attribute-skill-label">
                      <a class="actor-name">{{specialist.name}}</a>
                    </span>
                    <span id="wounds-stress-{{specialist._id}}" class="flex-horizontal">
                      <span class="flex-vertical">
                        <span class="flex-horizontal">
                          <span class="wounds-boxes attributes-container flex-horizontal">
                            <span>{{localize "BITD.Wounds"}}</span>
                            <input id="wounds-light-{{specialist._id}}" disabled type="radio" data-dtype="String" name="specialist.system.lightBox" value="{{specialist.system.lightBox}}">
                            <label for="wounds-light-{{specialist._id}}" style="background-color: {{specialist.system.lightBox}};"></label>
                            <input id="wounds-medium-{{specialist._id}}" disabled type="radio" data-dtype="String" name="specialist.system.mediumBox" value="{{specialist.system.mediumBox}}">
                            <label for="wounds-medium-{{specialist._id}}" style="background-color: {{specialist.system.mediumBox}};"></label>
                            <input id="wounds-heavy-{{specialist._id}}" disabled type="radio" data-dtype="String" name="specialist.system.heavyBox" value="{{specialist.system.heavyBox}}">
                            <label for="wounds-heavy-{{specialist._id}}" style="background-color: {{specialist.system.heavyBox}};"></label>
                          </span>
                          <span class="stress-boxes flex-horizontal">
                            <label for="stress-{{specialist._id}}">{{localize "BITD.Stress"}}</label>
                            <input id="stress-{{specialist._id}}" type="text" disabled name="specialist.system.stress.value" value="{{specialist.system.stress.value}} / {{str specialist.system.stress.max}}">
                          </span>
                        </span>
                        <span class="flex-horizontal">
                          <span class="stress-boxes flex-horizontal">
                            <label for="trauma-{{specialist._id}}">{{localize "BITD.Trauma"}}</label>
                            <input id="trauma-{{specialist._id}}" type="text" disabled name="specialist.system.trauma.value" value="{{specialist.system.trauma.value}} / {{str specialist.system.trauma.max}}">
                          </span>
                          <span class="stress-boxes flex-horizontal">
                            <label for="blight-{{specialist._id}}">{{localize "BITD.Blight"}}</label>
                            <input id="blight-{{specialist._id}}" type="text" disabled name="specialist.system.blight.value" value="{{specialist.system.blight.value}} / {{str specialist.system.blight.max}}">
                          </span>
                        </span>
                      </span>
                    </span>
                  </span>
                </span>
              {{/if}}
            {{/each}}
          </div>
        {{/each}}
      </div>

      <div class="tab flex-vertical" data-tab="actions">
        <div class="label-stripe">
          <p><label>{{localize "BITD.CampaignActions"}}</label></p>
        </div>
        <div class="actions-list">
          {{{localize "BITD.ActionsDetail"}}}
          <div class="label-stripe-gray">
            {{localize "BITD.Actions1"}}
          </div>
          {{{localize "BITD.Actions1Detail"}}}
          <div class="label-stripe-gray">
            {{localize "BITD.Actions2"}}
          </div>
          {{{localize "BITD.Actions2Detail"}}}
          <div class="label-stripe-gray">
            {{localize "BITD.Actions3"}}
          </div>
          {{{localize "BITD.Actions3Detail"}}}
          <div class="label-stripe-gray">
            {{localize "BITD.Actions4"}}
          </div>
          {{{localize "BITD.Actions4Detail"}}}
          <div class="label-stripe-gray">
            {{localize "BITD.Actions5"}}
          </div>
          {{{localize "BITD.Actions5Detail"}}}
        </div>
      </div>

      {{!-- Notes --}}
      <div class="tab flex-vertical" data-tab="character-notes">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Notes"}}</label></p>
        </div>
        <div class="description">
          {{{editor system.notes target="system.notes" button=true owner=owner editable=editable}}}
          {{#if editable}}
            <button type="submit" name="submit"><i class="fas fa-feather-alt"></i> {{localize "JOURNAL.Submit"}}</button>
          {{/if}}
        </div>
      </div>

      {{!-- Active Effects --}}
      <div id="effects" class="tab effects flex-vertical" data-tab="effects">
        <div class="label-stripe">
          <p><label>{{localize "BITD.Effects"}}</label></p>
        </div>
        {{> "systems/band-of-blades/templates/parts/active-effects.html"}}
      </div>

      {{!-- Full Item List --}}
      <div id="all-items" class="tab grow-two flex-vertical" data-tab="all-character-items">
        <div class="label-stripe">
          <p><label>{{localize "BITD.AllItems"}}</label></p>
        </div>
        {{#each items as |item id|}}
          <div class="item flex-horizontal" data-item-id="{{item._id}}">
            <div class="item-body item-sheet-open flex-horizontal">
              <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
              <a class="item-name">{{item.name}}</a>
            </div>
            <a class="item-control item-delete" title="{{localize 'BITD.TitleDeleteItem'}}"><i class="fas fa-trash"></i></a>
            <a class="item-control item-post" title="{{localize 'BITD.TitlePostItem'}}"><i class="fas fa-comment"></i></a>
          </div>
        {{/each}}
      </div>
    </div>
  </section>

</form>
